# 桌面图标位置备份工具 - 说明文档与使用手册

## 一、工具概述

桌面图标桌面图标位置备份工具是一款适用于Windows系统的批处理脚本工具，用于备份和还原桌面图标位置。当您调整桌面图标布局后，可通过本工具保存当前布局状态，在图标位置意外变动时快速恢复到理想状态。

**主要功能**：
- 创建桌面图标位置备份
- 从备份文件还原桌面图标位置
- 查看所有备份记录
- 修改备份文件存储路径
- 完全卸载工具

## 二、安装与首次使用

### 安装方法
1. 将脚本文件（`DesktopLayoutBackup.cmd`）保存到任意目录
2. 双击脚本文件即可运行（首次运行会自动完成配置）

### 首次运行配置
首次启动时，工具会：
1. 显示默认备份路径（`%USERPROFILE%\AppData\Local\DesktopIconBackupTool`）
2. 询问是否修改备份路径（输入Y修改，N使用默认）
3. 自动创建备份目录（若不存在）
4. 将配置信息保存到注册表（`HKCU\Software\DesktopIconBackupTool`）

## 三、操作指南

运行脚本后会显示主菜单，输入对应数字选择功能：

### 1. 创建新的桌面图标位置备份
- 选择"1"后，工具会自动：
  - 生成带有时间戳的备份文件（格式：`IconLayout_YYYYMMDD_HHMMSS.reg`）
  - 将当前桌面图标布局信息导出到备份文件
  - 显示备份成功信息及文件路径

### 2. 从备份还原桌面图标位置
- 选择"2"后：
  - 显示所有可用备份（按时间排序）
  - 输入要还原的备份编号
  - 工具会导入选中的备份文件
  - 自动重启资源管理器以应用更改
  - 提示还原完成

### 3. 查看所有备份
- 选择"3"后，工具会列出所有备份文件，包括：
  - 备份编号
  - 格式化的日期时间（YYYY-MM-DD HH:MM:SS）
  - 备份文件名

### 4. 修改备份路径
- 选择"4"后：
  - 显示当前备份路径和默认路径
  - 输入新路径（直接回车使用默认路径）
  - 自动创建新路径（若不存在）
  - 更新注册表中的配置信息

### 5. 卸载此工具
- 选择"5"后：
  - 显示卸载会执行的操作（删除备份文件、注册表配置和脚本本身）
  - 输入"Y"确认卸载（其他键取消）
  - 自动完成卸载流程并退出

### 6. 退出
- 选择"6"将直接退出工具

## 四、技术细节说明

1. **备份原理**：通过导出/导入注册表中存储桌面图标布局的键值（`HKCU\Software\Microsoft\Windows\Shell\Bags\1\Desktop`）实现备份与还原

2. **备份文件格式**：
   - 文件名格式：`IconLayout_YYYYMMDD_HHMMSS.reg`
   - 存储位置：用户指定的备份路径（默认路径见首次运行配置）

3. **配置存储**：工具配置（主要是备份路径）存储在注册表项`HKCU\Software\DesktopIconBackupTool`

4. **编码设置**：使用`chcp 936`确保中文正常显示

## 五、注意事项

1. 若备份失败，尝试以管理员身份运行脚本
2. 还原操作会重启资源管理器，可能导致正在进行的文件操作中断
3. 卸载操作会删除所有备份文件，请提前做好必要备份
4. 备份文件为注册表格式，可手动双击导入（效果与工具还原相同）
5. 建议定期创建备份，特别是在调整图标布局后

## 六、常见问题

**Q: 备份成功但还原后图标位置未变化？**  
A: 尝试重新启动电脑，或确认选择了正确的备份文件

**Q: 无法创建备份路径怎么办？**  
A: 检查路径权限，或选择其他分区/目录作为备份路径

**Q: 备份文件可以转移到其他电脑使用吗？**  
A: 不建议，桌面图标布局与系统配置、分辨率等相关，跨电脑还原可能效果不佳
